---
title: dockerfile 实践总结
date: 2019-09-24 10:00:00
tags: docker
categories: DevOps
---

> 最近工作比较忙，出差在外一直没有学习。学习了dockerfile的指令和编写，参考书中内容做了一些dockerfile的实践总结

<!-- more -->
首先要从实际的需求出发，定制适合应用、高校方便的镜像。

要熟悉每个指令的含义和执行效果，多编写一些简单的demo进行测试，然后再编写正式的dockerfile。

docker hub官方仓库中提供了大量的优秀镜像和对应的dockerfie，就像是阅读源码一样，学习如何撰写高效的dockerfile。

可以再编写dockerfile制作镜像过程中，从下面几个角度进行思考：

## 精简镜像用途
尽量让每个镜像的用途都比较集中、单一，避免构造大而复杂、多功能的镜像；

## 选用合适的基础镜像
过大的基础镜像会造成生成臃肿的镜像，一般推荐较为小巧的debian镜像；

## 提供足够清晰的命令注释和维护者信息
Dockerfile也是一种代码，需要考虑方便后续扩展和他人使用；

## 正确使用版本号
使用明确的版本号信息，如1.0，2.0，而非latest，将避免内容不一致可能引发的惨案；

## 减少镜像层数
如果希望所生成镜像的层数尽量少，则要尽量合并指令，例如多个RUN指令可以合并为一条；

## 及时删除临时文件和缓存文件
特别是在执行apt-get指令后，/var/cache/apt下面会缓存一些安装包；

## 提高生成速度
如合理使用缓存，减少内容目录下的文件，或使用.dockerignore文件指定等；

## 调整合理的指令顺序
在开启缓存的情况下，内容不变的指令尽量放在前面，这样可以尽量复用；

## 减少外部源的干扰 
如果确实要从外部引入数据，需要指定持久的地址，并带有版本信息，让他人可以重复而不出错。